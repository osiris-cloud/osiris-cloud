<div class="flex flex-col space-y-7 mt-6">

    <div class="flex flex-wrap w-full md:w-auto md:items-center gap-x-[6em] gap-y-2">
        <label for="min-replica" class="text-sm font-medium text-gray-900 dark:text-white flex-shrink-0 w-full md:w-40"
        >
            Minimum Replicas
        </label>
        <div class="relative flex-shrink-0 w-full md:w-auto">
            <div class="relative flex items-center">
                <button type="button" data-input-counter-decrement="min-replica"
                        class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 
                            hover:bg-gray-200 border border-gray-300 rounded-s-lg p-2 focus:ring-gray-100 
                            dark:focus:ring-gray-700 focus:ring-2 focus:outline-none h-8"
                >
                    <svg class="w-3 h-3 text-gray-900 dark:text-white"
                         xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 2">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M1 1h16">
                        </path>
                    </svg>
                </button>
                <input type="text" id="min-replica" placeholder="n" value="1"
                       class="bg-gray-50 border-x-0 border-gray-300 h-8 text-center text-gray-900 text-sm w-12 block 
                       py-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                       data-input-counter data-input-counter-min="1"
                />
                <button type="button" data-input-counter-increment="min-replica"
                        class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 
                            hover:bg-gray-200 border border-gray-300 rounded-e-lg p-2 h-8 
                            focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none"
                >
                    <svg class="w-3 h-3 text-gray-900 dark:text-white"
                         xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 18">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 1v16M1 9h16">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div class="flex flex-wrap w-full md:w-auto md:items-center gap-x-[6em] gap-y-2">
        <label class="text-sm font-medium text-gray-900 dark:text-white mb-2 md:mb-0 flex-shrink-0 w-full md:w-40">
            Enable Autoscaling
        </label>
        <div class="relative flex-shrink-0 w-full md:w-auto">
            <label class="inline-flex items-center cursor-pointer">
                <input id="autoscale-toggle" type="checkbox" value="" class="sr-only peer">
                <div class="relative w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full 
                    rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] 
                    after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border 
                    after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600">
                </div>
            </label>
        </div>
    </div>
    <script>
        (function () {
            const autoscaleToggle = $('#autoscale-toggle');
            autoscaleToggle.change(function () {
                if (this.checked)
                    $('[data-autoscale]').show();
                else
                    $('[data-autoscale]').hide();
            });
        })();

        $(window).on('load', function () {
            $('[data-autoscale]').hide();
        });
    </script>

    <div class="flex flex-wrap w-full md:w-auto md:items-center gap-x-[6em] gap-y-2" data-autoscale="true">
        <label for="max-replica" class="text-sm font-medium text-gray-900 dark:text-white
                                        flex-shrink-0 w-full md:w-40"
        >
            Maximum Replicas
        </label>
        <div class="relative flex-shrink-0 w-full md:w-auto">
            <div class="relative flex items-center">
                <button type="button" data-input-counter-decrement="max-replica"
                        class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 
                            hover:bg-gray-200 border border-gray-300 rounded-s-lg p-2 focus:ring-gray-100 
                            dark:focus:ring-gray-700 focus:ring-2 focus:outline-none h-8"
                >
                    <svg class="w-3 h-3 text-gray-900 dark:text-white"
                         xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 2">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M1 1h16">
                        </path>
                    </svg>
                </button>
                <input type="text" id="max-replica" value="2" placeholder="n"
                       class="bg-gray-50 border-x-0 border-gray-300 h-8 text-center text-gray-900 text-sm w-12
                           block py-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                       data-input-counter data-input-counter-min="2"
                />
                <button type="button" data-input-counter-increment="max-replica"
                        class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 
                            hover:bg-gray-200 border border-gray-300 rounded-e-lg p-2 h-8 
                            focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none"
                >
                    <svg class="w-3 h-3 text-gray-900 dark:text-white"
                         xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 18">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 1v16M1 9h16">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div class="flex flex-wrap w-full md:w-auto md:items-center gap-x-[6em] gap-y-2" data-autoscale="true">
        <label for="scaleup-stb-window" class="text-sm font-medium text-gray-900 dark:text-white mb-2 md:mb-0
                                         flex-shrink-0 w-full md:w-40"
        >
            Scale Up Stabilization Time
        </label>
        <div class="relative flex-shrink-0 w-full md:w-auto">
            <input type="number" id="scaleup-stb-window" value="0"
                   class="h-8 bg-gray-50 border border-gray-300 text-gray-500 text-sm rounded-lg 
                           focus:ring-blue-500 focus:border-blue-500 block w-full md:w-[23em] p-2.5 dark:bg-gray-700 
                           dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-blue-500 
                           dark:focus:border-blue-500 cursor-text"
                   placeholder="Enter time in seconds"
            >
        </div>
    </div>

    <div class="flex flex-wrap w-full md:w-auto md:items-center gap-x-[6em] gap-y-2" data-autoscale="true">
        <label for="scaledown-stb-window" class="text-sm font-medium text-gray-900 dark:text-white mb-2 md:mb-0
                                         flex-shrink-0 w-full md:w-40"
        >
            Scale Down Stabilization Time
        </label>
        <div class="relative flex-shrink-0 w-full md:w-auto">
            <input type="number" id="scaledown-stb-window" value="300"
                   class="h-8 bg-gray-50 border border-gray-300 text-gray-500 text-sm rounded-lg 
                           focus:ring-blue-500 focus:border-blue-500 block w-full md:w-[23em] p-2.5 dark:bg-gray-700 
                           dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-blue-500 
                           dark:focus:border-blue-500 cursor-text"
                   placeholder="Enter time in seconds"
            >
        </div>
    </div>

</div>

<div class="flex flex-col sm:flex-row items-start sm:items-center gap-x-[6em] gap-y-2 flex-1 w-full mt-7"
     data-autoscale="true">
    <label for="scaler-type" class="text-sm font-medium text-gray-900 dark:text-white flex-shrink-0 w-full md:w-40">
        Scaler
    </label>
    <div class="inline-flex gap-3">
        <select id="scaler-type" class="block p-1.5 w-full lg:max-w-[12.5em] md:max-w-[12.5em] text-sm text-gray-500 dark:text-white
                        rounded-md border-gray-300 bg-transparent dark:border-gray-600 shadow-sm focus:border-blue-500 
                        focus:ring-blue-500 h-8 disabled:opacity-50 disabled:cursor-not-allowed">
            <option class="dark:bg-gray-700" value="cpu" selected>CPU Utilization</option>
            <option class="dark:bg-gray-700" value="memory">Memory Utilization</option>
        </select>
        <div class="relative">
            <input type="number" id="target-value" placeholder="Target %" value="70"
                   class="bg-gray-50 border border-gray-300 h-8 text-center text-gray-900 text-sm w-[8em] block rounded-md
                                py-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white
                                disabled:opacity-50 disabled:cursor-not-allowed"
                   min="1" max="100"/>
            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-500 dark:text-gray-400">%</span>
        </div>
        <button id="add-scaler"
                class="flex items-center h-8 gap-2 px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg
                           hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-blue-600">
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                 stroke="currentColor"
            >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
        </button>
    </div>
</div>

<template id="scaler-template">
    <div class="flex items-center justify-between p-3 bg-white dark:bg-gray-700 rounded-lg shadow">
        <div class="flex items-center gap-4">
            <div class="flex flex-col">
                <span class="text-sm font-medium text-gray-900 dark:text-white scaler-type"></span>
                <span class="text-sm text-gray-500 dark:text-gray-400">
                        Target: <span class="target-value"></span>%
                    </span>
            </div>
        </div>
        <button class="remove-scaler text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>
</template>

<div id="scalers-list" class="mt-4 space-y-2" data-autoscale="true"></div>


<script>
    const addedScalers = new Set();
    const $scalerList = $('#scalers-list');
    const $addButton = $('#add-scaler');
    $(document).ready(function () {
        function createScalerItem(type, target) {
            const $template = $('#scaler-template');
            const $clone = $($template.html());
            $clone.attr('data-type', type);
            $clone.find('.scaler-type').text(`${type === 'cpu' ? 'CPU' : 'Memory'} Utilization`);
            $clone.find('.target-value').text(target);
            return $clone[0];
        }

        function updateUIState() {
            const $select = $('#scaler-type');
            const $targetInput = $('#target-value');

            $select.find('option').each(function () {
                const value = $(this).val();
                if (addedScalers.has(value))
                    $(this).prop('disabled', true);
                else
                    $(this).prop('disabled', false);
            });

            if (addedScalers.size >= 2) {
                $select.prop('disabled', true);
                $targetInput.prop('disabled', true);
                $addButton.prop('disabled', true);
            } else {
                $select.prop('disabled', false);
                $targetInput.prop('disabled', false);
                $addButton.prop('disabled', false);

                const firstAvailable = $select.find('option:not(:disabled)').first();
                $select.val(firstAvailable.val());
            }
        }

        $addButton.click(function () {
            const type = $('#scaler-type').val();
            const target = parseInt($('#target-value').val());

            if (!target || (target > 100)) {
                Alert('Scaling target value should be between 1 and 100');
                return;
            }

            addedScalers.add(type);
            $scalerList.append(createScalerItem(type, target));
            updateUIState();
        });

        $scalerList.on('click', '.remove-scaler', function () {
            const scalerDiv = $(this).closest('div[data-type]');
            const type = scalerDiv.data('type');
            addedScalers.delete(type);
            scalerDiv.remove();
            updateUIState();
        });

        window.getScalers = function () {
            const scalers = [];
            $scalerList.find('div[data-type]').each(function () {
                const type = $(this).data('type');
                const target = parseInt($(this).find('.target-value').text());
                scalers.push({
                    type: type,
                    target: !isNaN(target) ? Number(target) : null
                });
            });
            return scalers;
        };

        updateUIState();
    });
</script>
